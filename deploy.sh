#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

echo "üîß –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ VPN –±–æ—Ç–∞..."

# 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
cp .env .env.backup
cp vpn.db vpn.db.backup

# 2. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É–∂–±—ã
sudo systemctl stop vpn-bot.service
sudo systemctl stop vpn-web.service

# 3. –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ GitHub
git pull origin main

# 4. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
cp .env.backup .env
cp vpn.db.backup vpn.db

# 5. –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 6. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—ã
sudo systemctl start vpn-web.service
sudo systemctl start vpn-bot.service

echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üìä –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±:"
sudo systemctl status vpn-bot.service --no-pager -l
sudo systemctl status vpn-web.service --no-pager -l
